# Wagtail 6.0.2 release notes - IN DEVELOPMENT

_Unreleased_

```{contents}
---
local:
depth: 1
---
```

## What's new

### Bug fixes

 * Ensure that modal tabs width are not impacted by side panel opening (LB (Ben) Johnston)
 * Resolve issue local development of docs when running `make livehtml` (Sage Abdullah)
 * Resolve issue with unwanted padding in chooser modal listings (Sage Abdullah)
 * Ensure filter query parameters added in `IndexView.get_add_url()` is reflected in the "add" button URL when updating the listing (Sage Abdullah)


### Documentation

 * Update Sphinx theme to `6.3.0` with a fix for the missing favicon (Sage Abdullah)

## Upgrade considerations - changes to undocumented internals

### Changed behavior of "add" button link in index views of non-page models

In Wagtail 6.0, the behavior of how the `get_add_url()` method is used on a view that extends the Wagtail's generic `IndexView` (e.g. the index view class in a `ModelViewSet`/`SnippetViewSet`) was changed. Since the listing's filters are now applied dynamically via AJAX instead of a full page load, the link for the "add" button in the header only uses the `get_add_url()` method on the initial page load. To compensate this, the add link's element now has a client-side behavior that can reflect the query parameters from the browser's address bar or the URL of the `fetch()` request when updating the listing.

Before this patch release, the client-side element's default behavior only considers the `locale` query parameter, and any other query parameters are ignored. As of Wagtail 6.0.2, the client-side behavior has been improved to reflect all query parameters that are originally in the URL at the time the page is loaded.

You may have customised the `get_add_url()` method to return a URL with query parameters. For example, to apply query parameters based on the filters that have been applied, so that they are passed to the `CreateView`. If so, you may need to make some changes to ensure the parameters are still applied correctly.

This can be done by ensuring that the parameters always exist in the URL returned by `get_add_url()`, even when they are empty.

For example, if you have a custom `get_add_url()` method that looks like this:

```python
from wagtail.admin.utils import set_query_params
from wagtail.snippets.views.snippets import IndexView


class PrefilledParentIndexView(IndexView):
    def get_add_url(self):
        add_url = super().get_add_url()
        parent = self.filters.data.get("parent")
        if parent:
            add_url = set_query_params(add_url, {"parent": parent})
        return add_url
```

You will need to ensure that the `parent` parameter is always present in the URL returned by `get_add_url()`. This can be done by adding a default value for the parameter, like this:

```python
from wagtail.admin.utils import set_query_params
from wagtail.snippets.views.snippets import IndexView


class PrefilledParentIndexView(IndexView):
    def get_add_url(self):
        add_url = super().get_add_url()
        parent = self.filters.data.get("parent", "")
        add_url = set_query_params(add_url, {"parent": parent})
        return add_url
```

This will inform the client-side behavior to reflect the `parent` parameter in the URL when the listing is updated upon filtering.

Note that currently only query parameters that correspond to the filters' parameters are reflected to the "add" button URL. If you have custom query parameters that are not related to the filters, you may need to add custom JavaScript so that they are updated when the listing is refreshed. In the future, we are considering a different approach to ensure the "add" button URL always corresponds to the `get_add_url()` method when the listing is refreshed.

See [the related issue](https://github.com/wagtail/wagtail/issues/11726) for more details.
